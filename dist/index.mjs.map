{"version":3,"file":"index.mjs","sources":["../src/index.js"],"sourcesContent":["'use strict'\n\nimport trigger from 'trigger'\n\nexport default function pqueue (width = 1) {\n  const q = []\n  let running = 0\n  let _idle = trigger()\n  _idle.fire()\n\n  return {\n    push,\n    get running () {\n      return running\n    },\n    get pending () {\n      return q.length\n    },\n    get idle () {\n      return _idle\n    }\n  }\n\n  function push (fn) {\n    return new Promise((resolve, reject) => {\n      q.push(() => {\n        if (running++ === 0) _idle = trigger()\n        try {\n          Promise.resolve(fn()).then(\n            value => {\n              resolve(value)\n              done()\n            },\n            reason => {\n              reject(reason)\n              done()\n            }\n          )\n        } catch (reason) {\n          reject(reason)\n          done()\n        }\n      })\n      startOne()\n    })\n  }\n\n  function done () {\n    running--\n    startOne()\n  }\n\n  function startOne () {\n    if (running >= width) return\n    if (!q.length && !running) _idle.fire()\n    if (q.length) q.shift()()\n  }\n}\n"],"names":[],"mappings":";;AAIe,SAAS,MAAM,EAAE,KAAK,GAAG,CAAC,EAAE;EACzC,MAAM,CAAC,GAAG,GAAE;EACZ,IAAI,OAAO,GAAG,EAAC;EACf,IAAI,KAAK,GAAG,OAAO,GAAE;EACrB,KAAK,CAAC,IAAI,GAAE;EAEZ,OAAO;IACL,IAAI;IACJ,IAAI,OAAO,CAAC,GAAG;MACb,OAAO,OAAO;KACf;IACD,IAAI,OAAO,CAAC,GAAG;MACb,OAAO,CAAC,CAAC,MAAM;KAChB;IACD,IAAI,IAAI,CAAC,GAAG;MACV,OAAO,KAAK;KACb;GACF;EAED,SAAS,IAAI,EAAE,EAAE,EAAE;IACjB,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAK;MACtC,CAAC,CAAC,IAAI,CAAC,MAAM;QACX,IAAI,OAAO,EAAE,KAAK,CAAC,EAAE,KAAK,GAAG,OAAO,GAAE;QACtC,IAAI;UACF,OAAO,CAAC,OAAO,CAAC,EAAE,EAAE,CAAC,CAAC,IAAI;YACxB,KAAK,IAAI;cACP,OAAO,CAAC,KAAK,EAAC;cACd,IAAI,GAAE;aACP;YACD,MAAM,IAAI;cACR,MAAM,CAAC,MAAM,EAAC;cACd,IAAI,GAAE;aACP;YACF;SACF,CAAC,OAAO,MAAM,EAAE;UACf,MAAM,CAAC,MAAM,EAAC;UACd,IAAI,GAAE;SACP;OACF,EAAC;MACF,QAAQ,GAAE;KACX,CAAC;GACH;EAED,SAAS,IAAI,IAAI;IACf,OAAO,GAAE;IACT,QAAQ,GAAE;GACX;EAED,SAAS,QAAQ,IAAI;IACnB,IAAI,OAAO,IAAI,KAAK,EAAE,MAAM;IAC5B,IAAI,CAAC,CAAC,CAAC,MAAM,IAAI,CAAC,OAAO,EAAE,KAAK,CAAC,IAAI,GAAE;IACvC,IAAI,CAAC,CAAC,MAAM,EAAE,CAAC,CAAC,KAAK,EAAE,GAAE;GAC1B;CACF;;;;"}