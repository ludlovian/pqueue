{"version":3,"file":"index.mjs","sources":["../src/index.js"],"sourcesContent":["'use strict'\n\nimport trigger from 'trigger'\n\nexport default function pqueue (width = 1) {\n  const q = []\n  let running = 0\n  let _idle = trigger()\n  _idle.fire()\n\n  return {\n    push,\n    get running () {\n      return running\n    },\n    get pending () {\n      return q.length\n    },\n    get idle () {\n      return _idle\n    }\n  }\n\n  function push (fn) {\n    return new Promise((resolve, reject) => {\n      q.push(() => {\n        if (running++ === 0) _idle = trigger()\n        try {\n          Promise.resolve(fn()).then(\n            value => {\n              resolve(value)\n              done()\n            },\n            reason => {\n              reject(reason)\n              done()\n            }\n          )\n        } catch (reason) {\n          reject(reason)\n          done()\n        }\n      })\n      startOne()\n    })\n  }\n\n  function done () {\n    running--\n    startOne()\n  }\n\n  function startOne () {\n    if (running >= width) return\n    if (!q.length && !running) _idle.fire()\n    if (q.length) q.shift()()\n  }\n}\n"],"names":["width","q","running","_idle","trigger","fire","fn","Promise","resolve","reject","push","then","value","done","reason","startOne","length","shift"],"mappings":"sCAIe,SAAiBA,kBAAQ,OAChCC,EAAI,GACNC,EAAU,EACVC,EAAQC,WACZD,EAAME,OAEC,eAaQC,UACN,IAAIC,iBAASC,EAASC,GAC3BR,EAAES,gBACkB,GAAdR,MAAiBC,EAAQC,SAE3BG,QAAQC,QAAQF,KAAMK,cACpBC,GACEJ,EAAQI,GACRC,cAEFC,GACEL,EAAOK,GACPD,MAGJ,MAAOC,GACPL,EAAOK,GACPD,OAGJE,4BA9BOb,wBAGAD,EAAEe,0BAGFb,aA4BFU,IACPX,IACAa,aAGOA,IACHb,GAAWF,IACVC,EAAEe,QAAWd,GAASC,EAAME,OAC7BJ,EAAEe,QAAQf,EAAEgB,OAAFhB"}